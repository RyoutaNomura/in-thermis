<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel='stylesheet' href="../bower_components/font-awesome/css/font-awesome.css">

<dom-module id="resource-location">
<template>
<div class="container flex-horizontal">
  <div class="resource-icon">
    <i class$="fa {{resourceIcon}}"></i>
  </div>
  <div class="resource-type-name">{{resourceTypeName}}</div>
  <div class="resource-size">{{resourceSizeFormatted}}</div>
  <div class="flexchild"></div>
  <div id="buttons">
    <paper-icon-button
      id="show-link-button"
      icon="link"
      title="Show link"
      on-tap="onShowLinkButtonTap"></paper-icon-button>
    <paper-icon-button 
      id="download-button"
      icon="file-download"
      title="Download" 
      on-tap="onDownloadButtonTap"></paper-icon-button>
  </div>
</div>
<div id="path-box" class="container flex-horizontal" hidden="true">
  <div class="flexchild">
    <paper-input id="uri-input" value$="{{uri}}" readonly="true" no-label-float="true"></paper-input>
  </div>
  <paper-button on-tap="onCopyButtonTap">COPY</paper-button>
</div>
</template>

<style>
:host {
}

.flex-horizontal { 
  @apply (--layout-horizontal);
  @apply(--layout-center);
}

.flexchild {
  @apply (--layout-flex);
}

.resource-icon{
}

.resource-type-name{
  font-size: small;
  margin-left: 5px;
}

.resource-size{
  font-size: small;
  margin-left: 10px;
}

#buttons {
  margin-left: 5px;
}

#buttons paper-icon-button {
  margin-left: 5px;
  --paper-icon-button: {
    padding: 0;
    height: 24px;
    width: 24px;
  }
}

#path-box paper-input {
  --paper-input-container-focus-color: none;
  --paper-input-container: {
    font-size:small;
  }
}

</style>

<script>
	Polymer({
		is : "resource-location",
		properties : {
			uri :　String,
			resourceSize : Number,
			resourceSizeFormatted: {
				type: String,
				computed: 'formatNumber(resourceSize)'
			},
			resourceTypeName : String,
			resourceIcon : {
				type: String,
				computed: 'resolveResourceIcon(indexerClassName)',
			},
			indexerClassName: String
		},
		
		resolveResourceIcon: function(indexerClassName) {
			if (indexerClassName === "logic.indexer.impl.OdsIndexer") {
				return "fa-file-excel-o";
			}
			return "";
		},
		
		formatNumber: function(resourceSize) {
			return Number(Math.floor(resourceSize/1000)).toLocaleString() + " KB";
		},
		
		onShowLinkButtonTap: function() {
			this.$['path-box'].hidden = false;
			this.$['show-link-button'].hidden = true;
		},
		
		onDownloadButtonTap: function() {
			var ref = window.location.href = this.uri;
			if (ref == null) {
				// TODO ダイアログ化
				alert('ファイルのダウンロードに失敗しました。')
			}
		},
		
		onCopyButtonTap: function() {
			var textArea = document.createElement("textarea");
			textArea.value = this.uri;
			Polymer.dom(document.body).appendChild(textArea);
			textArea.select();
			try {
				document.execCommand('copy');
			} catch (err) {
				console.log('Oops, unable to copy');
			}
			Polymer.dom(document.body).removeChild(textArea);
		}
	});
</script> </dom-module>
